function element_group(a,e,t,r,n,i,d,s,o,l,c){var m=t+"px "+r+"px",p=" scale("+n+","+i+") "+(" translate("+d+","+s+") ")+(" rotate("+o+") ");return l?a.insert("g",c).attr("id",e).attr("transform-origin",m).attr("transform",p):a.append("g").attr("id",e).attr("transform-origin",m).attr("transform",p),d3.select("#"+e)}function element_polygon(a,e,t,r,n,i,d,s,o,l,c){var m=" scale("+r+","+n+") "+(" translate("+i+","+d+") ")+(" rotate("+s+") "),p=" fill:"+o+"; "+(" stroke:"+l+"; ")+(" stroke-width:"+c+"; ");return a.append("polygon").attr("id",e).attr("points",t).attr("style",p).attr("transform",m),d3.select("#"+e)}function element_path(a,e,t,r,n,i,d,s,o,l,c,m,p,u,g){var f=" scale("+r+","+n+") "+(" translate("+i+","+d+") ")+(" rotate("+s+") "),w=" fill:"+o+"; "+(" stroke:"+o+"; ")+(" stroke-width:"+m+"; ");return a.append("path").attr("id",e).attr("d",t).attr("fill-opacity",l).attr("stroke-opacity",p).attr("fill-rule","evenodd").attr("stroke-linejoin",u).attr("stroke-linecap",g).attr("style",w).attr("transform",f),d3.select("#"+e)}function element_linearGradient(a,e,t,r,n,i,d){var s="0%";if(t>100){console.log("(element_linearGradient) - max x1 is 100");s="100%"}else if(t<0){console.log("(element_linearGradient) - min x1 is 0");s="0%"}else s=t+"%";var o="0%";if(r>100){console.log("(element_linearGradient) - max y1 is 100");o="100%"}else if(r<0){console.log("(element_linearGradient) - min y1 is 0");o="0%"}else o=r+"%";var l="0%";if(n>100){console.log("(element_linearGradient) - max x2 is 100");l="100%"}else if(n<0){console.log("(element_linearGradient) - min x2 is 0");l="0%"}else l=n+"%";var c="0%";if(i>100){console.log("(element_linearGradient) - max y2 is 100");c="100%"}else if(i<0){console.log("(element_linearGradient) - min y2 is 0");c="0%"}else c=i+"%";return a.append("defs").attr("id","defs_"+e).append("linearGradient").attr("id",e).attr("x1",s).attr("y1",o).attr("x2",l).attr("y2",c),d.forEach((function(a,t,r){var n=" stop-color:"+a.color+"; "+(" stop-opacity:"+a.opacity+"; ");d3.select("#"+e).append("stop").attr("offset",a.offset+"%").attr("style",n)})),d3.select("#"+e)}function element_radialGradient(a,e,t){return a.append("defs").attr("id","defs_"+e).append("radialGradient").attr("id",e),t.forEach((function(a,t,r){var n=" stop-color:"+a.color+"; "+(" stop-opacity:"+a.opacity+"; ");d3.select("#"+e).append("stop").attr("offset",a.offset+"%").attr("style",n)})),d3.select("#"+e)}function element_ellipse(a,e,t,r,n,i,d,s,o,l,c,m,p,u){var g=" scale("+l+","+c+") "+(" translate("+m+","+p+") ")+(" rotate("+u+") "),f=" fill:"+d+"; "+(" stroke:"+s+"; ")+(" stroke-width:"+o+"; ");return a.append("ellipse").attr("id",e).attr("cx",t).attr("cy",r).attr("rx",n).attr("ry",i).attr("style",f).attr("transform",g),d3.select("#"+e)}function element_circle(a,e,t,r,n,i,d,s,o,l,c,m,p){var u=" scale("+o+","+l+") "+(" translate("+c+","+m+") ")+(" rotate("+p+") "),g=" fill:"+i+"; "+(" stroke:"+d+"; ")+(" stroke-width:"+s+"; ");return a.append("circle").attr("id",e).attr("cx",t).attr("cy",r).attr("r",n).attr("style",g).attr("transform",u),d3.select("#"+e)}function element_rect(a,e,t,r,n,i,d,s,o,l,c,m){var p=" scale("+s+","+o+") "+(" translate("+l+","+c+") ")+(" rotate("+m+") "),u=" fill:"+n+"; "+(" stroke:"+i+"; ")+(" stroke-width:"+d+"; ");return a.append("rect").attr("id",e).attr("width",t).attr("height",r).attr("style",u).attr("transform",p),d3.select("#"+e)}function element_img(a,e,t,r,n,i,d,s,o,l,c,m){var p=" scale("+s+","+o+") "+(" translate("+l+","+c+") ")+(" rotate("+m+") "),u=" stroke:"+i+"; "+(" stroke-width:"+d+"; ");return a.append("image").attr("id",e).attr("width",t).attr("height",r).attr("href",n).attr("style",u).attr("transform",p),d3.select("#"+e)}function changeImageBrightness(a,e,t="1s"){d3.select(`#${a}`).transition().duration(t).style("filter",`brightness(${e}%)`)}function changeImageScale(a,e,t="1s"){d3.select(`#${a}`).transition().duration(t).style("transform",`scale(${e})`)}function changeImagePosition(a,e,t,r=1e3){d3.select(`#${a}`).transition().duration(r).style("transform",`translate(${e}px, ${t}px)`)}function changeImageSrcWithFadeIn(a,e,t,r=100){const n=d3.select(`#${a}`);n.attr("href",e),n.transition().duration(t).style("filter",`brightness(${r}%)`)}function updateImageProperties(a,e,t,r,n,i="1s"){const d=`scale(${t}) translate(${r}px, ${n}px)`;d3.select(`#${a}`).transition().duration(i).style("filter",`brightness(${e}%)`).style("transform",d)}function element_text(a,e,t,r,n,i,d,s,o,l,c,m){var p=" scale("+s+","+o+") "+(" translate("+l+","+c+") ")+(" rotate("+m+") "),u=" stroke:"+i+"; "+(" stroke-width:"+d+"; ");return a.append("text").attr("id",t).attr("x",r).attr("y",n).attr("style",u).attr("transform",p).text(e),d3.select("#"+t)}function isEmpty(a){for(var e in a)if(Object.prototype.hasOwnProperty.call(a,e))return!1;return!0}function BodyBuilder(a,e,t){return e.element=element_group(a,e.data.id,e.data.origX,e.data.origY,e.data.scalX,e.data.scalY,e.data.tranX,e.data.tranY,e.data.rotat),e.all=[],e.all.push(e.element),e.eggrest={},function(a,t,r,n){t.Back.element=element_group(a,t.Back.data.id,t.data.origX,t.data.origY,t.data.scalX,t.data.scalY,t.data.tranX,t.data.tranY,t.data.rotat),t.Head.element=element_group(a,t.Head.data.id,t.Head.data.origX,t.Head.data.origY,t.Head.data.scalX,t.Head.data.scalY,t.Head.data.tranX,t.Head.data.tranY,t.Head.data.rotat),sub_body_Processing(e,t.Back.element,t.Back.Capes,!0,!1,n),sub_body_Processing(e,t.Back.element,t.Back.WingLeftY,!0,!1,n),sub_body_Processing(e,t.Back.element,t.Back.WingRight,!0,!1,n),sub_body_Processing(e,t.Head.element,t.Head.Hair.Hind,!0,!1,n),sub_body_Processing(e,t.Head.element,t.Head.Hair.Extra,!0,!1,n),sub_body_Processing(e,t.Head.element,t.Head,!1,!1,n),t.Head.Face.element=element_group(t.Head.element,t.Head.Face.data.id,t.data.origX,t.data.origY,t.data.scalX,t.data.scalY,t.data.tranX,t.data.tranY,t.data.rotat),t.Head.Hair.element=element_group(t.Head.element,t.Head.Hair.data.id,t.Head.data.origX,t.Head.data.origY,t.Head.data.scalX,t.Head.data.scalY,t.Head.data.tranX,t.Head.data.tranY,t.Head.data.rotat),sub_body_Processing(e,t.Head.Face.element,t.Head.Face.Emote,!0,!1,n),sub_body_Processing(e,t.Head.Face.element,t.Head.Face.Eyes,!0,!1,n),function(a){if(!isEmpty(a.gdata)){var e=a.data.id+"eyes_mask",t=a.element.append("defs").attr("id","defs_"+e);t.append("clipPath").attr("id","clipPath_LeftY_eye_back"+e),t.append("clipPath").attr("id","clipPath_Right_eye_back"+e),r(a.gdata.LeftYeye_back_elem.element,"clipPath_LeftY_eye_back"+e,"clipPath"),r(a.gdata.Righteye_back_elem.element,"clipPath_Right_eye_back"+e,"clipPath"),a.gdata.LeftYpupil_main_elem.element.attr("clip-path","url(#clipPath_LeftY_eye_back"+e+")"),a.gdata.Rightpupil_main_elem.element.attr("clip-path","url(#clipPath_Right_eye_back"+e+")"),a.gdata.LeftYgloss_elem.element.attr("clip-path","url(#clipPath_LeftY_eye_back"+e+")"),a.gdata.Rightgloss_elem.element.attr("clip-path","url(#clipPath_Right_eye_back"+e+")"),t.append("clipPath").attr("id","clipPath_LeftY_pupil_main"+e),t.append("clipPath").attr("id","clipPath_Right_pupil_main"+e),r(a.gdata.LeftYpupil_main_elem.element,"clipPath_LeftY_pupil_main"+e,"clipPath"),r(a.gdata.Rightpupil_main_elem.element,"clipPath_Right_pupil_main"+e,"clipPath"),null!=a.gdata.LeftYpupil_inner_elem&&a.gdata.LeftYpupil_inner_elem.element.attr("clip-path","url(#clipPath_LeftY_pupil_main"+e+")"),null!=a.gdata.Rightpupil_inner_elem&&a.gdata.Rightpupil_inner_elem.element.attr("clip-path","url(#clipPath_Right_pupil_main"+e+")")}function r(a,e,t){a.selectAll("*").each((function(){var a=this.cloneNode(!0);a.id=this.id+t,a.removeAttribute("style"),d3.select("#"+e).node().appendChild(a)}))}}(t.Head.Face.Eyes),sub_body_Processing(e,t.Head.Face.element,t.Head.Face.Mouth,!0,!1,n),sub_body_Processing(e,t.Head.Face.element,t.Head.Face.Nose,!0,!1,n),sub_body_Processing(e,t.Head.Face.element,t.Head.Face.Ears,!0,!1,n),sub_body_Processing(e,t.Head.Face.element,t.Head.Face.Accessory,!0,!1,n),sub_body_Processing(e,t.Head.Face.element,t.Head.Face.Glasses,!0,!1,n),sub_body_Processing(e,t.Head.Hair.element,t.Head.Hair.SpEarsRight,!0,!1,n),sub_body_Processing(e,t.Head.Hair.element,t.Head.Hair.Back,!0,!1,n),sub_body_Processing(e,t.Head.Hair.element,t.Head.Hair.Pony,!0,!1,n),sub_body_Processing(e,t.Head.Hair.element,t.Head.Hair.Front,!0,!1,n),sub_body_Processing(e,t.Head.Hair.element,t.Head.Hair.Tip,!0,!1,n),sub_body_Processing(e,t.Head.Hair.element,t.Head.Face.Eyebrows,!0,!1,n),sub_body_Processing(e,t.Head.Hair.element,t.Head.Hair.SpEarsLeftY,!0,!1,n),sub_body_Processing(e,t.Head.Hair.element,t.Head.Hair.Accessory,!0,!1,n),e.all.push(t),e.all.push(t.Head),e.all.push(t.Head.Hair),e.all.push(t.Head.Face)}(e.element,e.UpperBody,e.name,t),function(a,t,r,n){var i=t.draw.Dime.bbox.x+t.draw.Dime.bbox.width*t.draw.Dime.magX,d=t.draw.Dime.bbox.y+t.draw.Dime.bbox.height*t.draw.Dime.magY;function s(a,t,r,n,i){sub_body_Processing(e,a,t.Leg,r,n,i),sub_body_Processing(e,t.Leg.element,t.Calf,r,n,i),sub_body_Processing(e,t.Calf.element,t.Foot,r,n,i)}t.element=element_group(a,t.data.id,i,d,t.data.scalX,t.data.scalY,t.data.tranX,t.data.tranY,t.data.rotat),e.all.push(t),sub_body_Processing(e,t.element,t.Back.Tails,!0,!1,n),s(t.element,t.Right,!0,!0,n),s(t.element,t.LeftY,!0,!0,n),sub_body_Processing(e,a,t,!1,!0,n)}(e.element,e.LowerBody,e.name,t),function(a,t,r,n){function i(a,t,r,n,i){sub_body_Processing(e,a,t.Arm,r,n,i),sub_body_Processing(e,t.Arm.element,t.Fore,r,n,i),sub_body_Processing(e,t.Fore.element,t.Hand,r,n,i)}t.element=element_group(a,t.data.id,t.data.origX,t.data.origY,t.data.scalX,t.data.scalY,t.data.tranX,t.data.tranY,t.data.rotat),i(t.element,t.Right,!0,!0,n),sub_body_Processing(e,a,t,!1,!0,n),sub_body_Processing(e,t.element,t.Head.Face.Neck,!0,!1,n),i(t.element,t.LeftY,!0,!0,n)}(e.element,e.UpperBody,e.name,t),function(a,e,r){function n(a,e,r){var n=a.Clothes[e];a.Clothes[e].draw.helper=[],a.Clothes[e].draw.Pathfull.forEach((function(t,r,n){for(var i=a,d=0;d<t.p.length;d++)i=i[t.p[d]];var s=!0;a.Clothes[e].draw.helper.forEach((function(a,e,t){a.desired_element_id===i.data.id&&(s=!1)})),s&&a.Clothes[e].draw.helper.push({desired_element_id:i.data.id,desired_element:i,Pathfull:[]})})),a.Clothes[e].draw.Pathfull.forEach((function(t,r,n){for(var i=a,d=0;d<t.p.length;d++)i=i[t.p[d]];a.Clothes[e].draw.helper.forEach((function(a,e,r){a.desired_element_id==i.data.id?a.Pathfull.push(t):a.Pathfull.push(!1)}))}));var i=[];a.Clothes[e].draw.helper.forEach((function(a,e,t){var r=[];(r=JSON.parse(JSON.stringify(n))).draw.Pathfull=a.Pathfull,r.desired_element=a.desired_element,r.draw.helper=null,i.push(r)})),a.Clothes[e].draw.helper=i,a.Clothes[e].element=[],a.Clothes[e].draw.helper.forEach((function(r,n,i){r.data.id="part"+n+r.data.id,a.Clothes[e].element.push(sub_body_Processing(a,r.desired_element.addergroup,r,!0,!1,t))}))}n(a,"ClothesBelt"),n(a,"ClothesGloves"),n(a,"ClothesPants"),n(a,"ClothesShirt"),n(a,"ClothesShoes"),n(a,"ClothesSleeves")}(e,e.Clothes,e.name),d3.select("#dummyArea_"+e.name).remove(),d3.select("#FullChar_"+e.name).attr("transform-origin",e.UpperBody.data.origX+"px "+e.UpperBody.data.origY+"px"),e.test=async function(){async function a(a){a.Foot.anim.prim.test(),await sleep(4500),a.Calf.anim.prim.test(),await sleep(4500),a.Leg.anim.prim.test(),await sleep(4500),a.Foot.anim.prim.test(),a.Calf.anim.prim.test(),a.Leg.anim.prim.test()}async function t(a){a.Hand.anim.prim.test(),await sleep(4500),a.Fore.anim.prim.test(),await sleep(4500),a.Arm.anim.prim.test(),await sleep(4500),a.Hand.anim.prim.test(),a.Fore.anim.prim.test(),a.Arm.anim.prim.test()}console.log("=== ==> body_test_Lower_patrs"),a(e.LowerBody.LeftY),a(e.LowerBody.Right),await sleep(13500),console.log("=== ==> body_test_Upper_parts"),t(e.UpperBody.LeftY),t(e.UpperBody.Right),console.log("=== ==> body_test_Head"),e.UpperBody.Head.anim.prim.test(),await sleep(13500),console.log("=== ==> body_test_LowerBody"),e.LowerBody.anim.prim.test(),await sleep(4500),console.log("=== ==> body_test_UpperBody"),e.UpperBody.anim.prim.test(),await sleep(4500),console.log("=== ==> body_test_All"),console.log("==> Test Done")},e.movePupil={},e.movePupil.raw=async function(a,e){e.actionDuration=void 0===e.actionDuration?1e3:e.actionDuration,e.del=void 0===e.del?0:e.del,e.ease=void 0===e.ease?d3.easeCubic:e.ease,a.selectAll("path").each((function(){var a=d3.select(this),t=a.attr("d").split(/(?=[LMC])/),r=t[0].trim().split(" ");r[1]=Number(r[1])+e.x,r[2]=Number(r[2])+e.y,t[0]=r.join(" ");var n=t.join(" ");d3.transition().duration(e.actionDuration).delay(e.del).ease(e.ease);a.transition().duration(e.actionDuration).attr("d",n)}))},e.movePupil.LeftY={},e.movePupil.LeftY.pupilMain=async function(a){let t=e.UpperBody.Head.Face.Eyes.gdata.LeftYpupil_main_elem.element;e.movePupil.raw(t,a)},e.movePupil.LeftY.pupilInner=async function(a){if(null!=e.UpperBody.Head.Face.Eyes.gdata.LeftYpupil_inner_elem){let t=e.UpperBody.Head.Face.Eyes.gdata.LeftYpupil_inner_elem.element;e.movePupil.raw(t,a)}},e.movePupil.LeftY.gloss=async function(a){let t=e.UpperBody.Head.Face.Eyes.gdata.LeftYgloss_elem.element;e.movePupil.raw(t,a)},e.movePupil.Right={},e.movePupil.Right.pupilMain=async function(a){let t=e.UpperBody.Head.Face.Eyes.gdata.Rightpupil_main_elem.element;e.movePupil.raw(t,a)},e.movePupil.Right.pupilInner=async function(a){if(null!=e.UpperBody.Head.Face.Eyes.gdata.LeftYpupil_inner_elem){let t=e.UpperBody.Head.Face.Eyes.gdata.Rightpupil_inner_elem.element;e.movePupil.raw(t,a)}},e.movePupil.Right.gloss=async function(a){let t=e.UpperBody.Head.Face.Eyes.gdata.Rightgloss_elem.element;e.movePupil.raw(t,a)},console.log("Builder Output of Char: "+e.name+" <->",e),e}function sub_body_Processing(a,e,t,r,n,i){var d=t.draw;d.Pathfull.length!=d.Data.length&&console.error("The Poly and data are not in sycn for ID:"+t.data.id);var s=d.Dime.bbox.x+d.Dime.bbox.width*d.Dime.magX,o=d.Dime.bbox.y+d.Dime.bbox.height*d.Dime.magY;r&&(t.element=element_group(e,t.data.id,s,o,t.data.scalX,t.data.scalY,t.data.tranX,t.data.tranY,t.data.rotat),a.all.push(t)),t.anim.prim=anim_Standard_data(a,t,a.name,e,t.partnames),i&&element_circle(t.element,"Origin_Rotate_"+t.data.id,s,o,10,"Red","Red",1,1,1,0,0,0),i&&element_circle(t.element,"Origin_LeftY_"+t.data.id,d.Dime.bbox.x,o,1,"Gray","Gray",1,1,1,0,0,0),i&&element_circle(t.element,"Origin_Right_"+t.data.id,d.Dime.bbox.x+d.Dime.bbox.width,o,1,"Gray","Gray",1,1,1,0,0,0);parseInt(t.data.origX),d.Dime.maxX,parseInt(t.data.origX),d.Dime.minX,d.Dime.magX;t.colorGroup.forEach((function(a,e,r){addColorGroup(t,a,e)})),t.lineGroup.forEach((function(a,e,r){addLineGroup(t,a,e)})),t.gdata={};let l=[0,0];return needed=!0,d.Pathfull.forEach((function(e,r,n){if(0!=e){if(bpd_ele=t.element,null!=e.g){if(needed){var i=e.d.split(/(?=[LMC])/)[0].trim().split(" ");l=i,needed=!1}id_string="",next_elem=null,cuur_elem=t.element;t.gdata;for(var s=0,o=[],c=0;c<e.g.length;c++){id_string+=e.g[c],t.partID=t.data.id+id_string,s=Rotation_points(t,a.name.replace(".","_"),e,o,0,0,0,s,!1,l);var m={x:Number(0)+Number(l[1]),y:Number(0)+Number(l[2]),width:0,height:s},p=m.x+1*m.width,u=m.y+1*m.height;next_elem=d3.select("#"+t.data.id+id_string),next_elem.empty()&&(next_elem=element_group(cuur_elem,t.data.id+id_string,p,u,t.data.scalX,t.data.scalY,t.data.tranX,t.data.tranY,t.data.rotat),t.gdata[id_string+"_elem"]={element:next_elem}),cuur_elem=next_elem}bpd_ele=cuur_elem}0!=t.colorGroup[e.c-1]&&element_path(bpd_ele,"PathPoly_"+(r+1)+t.data.id,e.d,d.Data[r].scalX,d.Data[r].scalY,d.Data[r].tranX,d.Data[r].tranY,d.Data[r].rotat,"url(#ColorGradient_"+e.c+t.data.id+")",d.Data[e.c-1].fillop,"Black",d.Data[r].strokW,0),0!=t.lineGroup[e.c-1]&&element_path(bpd_ele,"PathLine_"+(r+1)+t.data.id,e.d,d.Data[r].scalX,d.Data[r].scalY,d.Data[r].tranX,d.Data[r].tranY,d.Data[r].rotat,"url(#LineGradient_"+e.c+t.data.id+")",0,"url(#LineGradient_"+e.c+t.data.id+")",d.Data[e.c-1].strokW,d.Data[r].strokop,"round","butt")}})),n&&(t.addergroup=element_group(t.element,t.data.id+"addergroup",s,o,t.data.scalX,t.data.scalY,t.data.tranX,t.data.tranY,t.data.rotat)),t.element}function addPathData(){}function addLineGroup(a,e,t){0!=e&&(1==e.type?element_linearGradient(a.element,"LineGradient_"+(t+1)+a.data.id,0,0,0,100,e.color):2==e.type?element_radialGradient(a.element,"LineGradient_"+(t+1)+a.data.id,e.color):(element_radialGradient(a.element,"LineGradient_"+(t+1)+a.data.id,0,e.color),console.error("bodyPartData.colortype was not 1,2 for ID:"+a.data.id)))}function addColorGroup(a,e,t){if(0!=e)if(1==e.type)if(void 0===e.cord)if(void 0===e.gradient)element_linearGradient(a.element,"ColorGradient_"+(t+1)+a.data.id,0,0,0,100,e.color);else{element_linearGradient(a.element,"ColorGradient_"+(t+1)+a.data.id,100*Number(e.gradient.x1),100*Number(e.gradient.y1),100*Number(e.gradient.x2),100*Number(e.gradient.y2),e.color)}else console.log("cord ASD"),element_linearGradient(a.element,"ColorGradient_"+(t+1)+a.data.id,e.cord.x1,e.cord.y1,e.cord.x2,e.cord.y2,e.color);else 2==e.type?element_radialGradient(a.element,"ColorGradient_"+(t+1)+a.data.id,e.color):(element_radialGradient(a.element,"ColorGradient_"+(t+1)+a.data.id,0,e.color),console.error("bodyPartData.colortype was not 1,2 for ID:"+a.data.id))}function multiBodyBuilder(a,e){var t=[];return a.forEach((function(a,r,n){t.push(BodyBuilder(a.Z_FSTS,a,e))})),t}function anim_Standard_data(a,e,t,r,n){var i={test:async function(){console.log("==> X and Y rotation to 200 for "+e.data.id),e.element.transition().duration(500).style("transform","rotate(200deg)"),await sleep(500),console.log("==> X and Y rotation to  for "+e.data.id),e.element.transition().duration(500).style("transform","rotate(0deg)"),await sleep(500),console.log("==> Turn left for "+e.data.id),e.element.transition().duration(500).style("transform","skewY(30deg)"),await sleep(500),console.log("==> Turn right for "+e.data.id),e.element.transition().duration(500).style("transform","skewY(330deg)"),await sleep(500),console.log("==> Scale in  for "+e.data.id),e.element.transition().duration(500).style("transform","scale(1,0.5)"),await sleep(500),console.log("==> Scale out for "+e.data.id),e.element.transition().duration(500).style("transform","scale(1,1)"),await sleep(500),console.log("==> Scale in  for "+e.data.id),e.element.transition().duration(500).style("transform","scale(1,0.5)"),await sleep(500),console.log("==> Scale out for "+e.data.id),e.element.transition().duration(500).style("transform","scale(1,1)"),await sleep(500)},addEggrest:async function(t){return new Promise((async function(r,n){try{let r="Eggrest_"+e.data.id;var i=d3.select(`#${r}`);i.empty()&&(i=element_group(e.element,r,a.data.origX,a.data.origY,1,1,0,0,0,!0,":first-child"));const n=await fetch(t),d=await n.text(),s=(new DOMParser).parseFromString(d,"image/svg+xml"),o=d3.select(s).select("svg").node(),l=Array.from(o.childNodes);let c=d3.select(`#${r}`).node();for(const a of l)c.appendChild(a);element_group(d3.select(`#${r}`),"Eggrest_img_"+e.data.id,0,0,1,1,0,0,0)}catch(a){console.error("Failed to copy SVG content:",a)}r()}))},EggrestTransform:async function(a){return new Promise((async function(t,r){null==a.dur&&(a.dur=0),null==a.del&&(a.del=0),null==a.scalX&&(a.scalX=0),null==a.scalY&&(a.scalY=0),null==a.tranX&&(a.tranX=0),null==a.tranY&&(a.tranY=0),null==a.skewX&&(a.skewX=0),null==a.skewY&&(a.skewY=0),null==a.rotat&&(a.rotat=0),null==a.ease&&(a.ease=d3.easeCubic);let n="Eggrest_"+e.data.id;isEmpty(e.Eggrest)||null==e.Eggrest?(e.Eggrest={},e.Eggrest.data={},e.Eggrest.data.scalX=1+a.scalX,e.Eggrest.data.scalY=1+a.scalY,e.Eggrest.data.tranX=0+a.tranX,e.Eggrest.data.tranY=0+a.tranY,e.Eggrest.data.skewX=0+a.skewX,e.Eggrest.data.skewY=0+a.skewY,e.Eggrest.data.rotat=0+a.rotat):(e.Eggrest.data.scalX=e.Eggrest.data.scalX+a.scalX,e.Eggrest.data.scalY=e.Eggrest.data.scalY+a.scalY,e.Eggrest.data.tranX=e.Eggrest.data.tranX+a.tranX,e.Eggrest.data.tranY=e.Eggrest.data.tranY+a.tranY,e.Eggrest.data.skewX=e.Eggrest.data.skewX+a.skewX,e.Eggrest.data.skewY=e.Eggrest.data.skewY+a.skewY,e.Eggrest.data.rotat=e.Eggrest.data.rotat+a.rotat);var i=d3.transition().duration(a.dur).delay(a.del).ease(a.ease);let d="scale("+e.Eggrest.data.scalX+","+e.Eggrest.data.scalY+")  translate("+e.Eggrest.data.tranX+","+e.Eggrest.data.tranY+")  rotate("+e.Eggrest.data.rotat+") skewX("+e.Eggrest.data.skewX+") skewY("+e.Eggrest.data.skewY+")";console.log(d),d3.select(`#${n}`).transition(i).attr("transform",d),await sleep(1*(a.dur+a.del)),t()}))},clearEggrest:async function(){return new Promise((async function(a,t){let r=d3.select("#"+("Eggrest_"+e.data.id));r.selectAll("*").remove(),r.attr("transform"," "),e.Eggrest.data.scalX=1,e.Eggrest.data.scalY=1,e.Eggrest.data.tranX=0,e.Eggrest.data.tranY=0,e.Eggrest.data.skewX=0,e.Eggrest.data.skewY=0,e.Eggrest.data.rotat=0,a()}))},addImage:async function(a,t,r,n,i){const d=d3.select("#Eggrest_img_"+e.data.id);console.log(d.node()),console.log("#Eggrest_img_"+e.data.id),d.insert("image").attr("href",a).attr("width",t).attr("height",r).attr("x",n).attr("y",i)},addEggrestImg:async function(e,t,r){return new Promise((async function(n,i){await a.anim.prim.addEggrest(e),a.anim.prim.addImage(t,r.width,r.height,r.x,r.y),n()}))},gdataTransform:function(a,e){return new Promise((async function(t,r){null==e.dur&&(e.dur=0),null==e.del&&(e.del=0),null==e.scalX&&(e.scalX=0),null==e.scalY&&(e.scalY=0),null==e.tranX&&(e.tranX=0),null==e.tranY&&(e.tranY=0),null==e.skewX&&(e.skewX=0),null==e.skewY&&(e.skewY=0),null==e.rotat&&(e.rotat=0),null==e.ease&&(e.ease=d3.easeCubic),isEmpty(a.part)||null==a.part?(a.part={},a.part.data={},a.part.data.scalX=1+e.scalX,a.part.data.scalY=1+e.scalY,a.part.data.tranX=0+e.tranX,a.part.data.tranY=0+e.tranY,a.part.data.skewX=0+e.skewX,a.part.data.skewY=0+e.skewY,a.part.data.rotat=0+e.rotat):(a.part.data.scalX=a.part.data.scalX+e.scalX,a.part.data.scalY=a.part.data.scalY+e.scalY,a.part.data.tranX=a.part.data.tranX+e.tranX,a.part.data.tranY=a.part.data.tranY+e.tranY,a.part.data.skewX=a.part.data.skewX+e.skewX,a.part.data.skewY=a.part.data.skewY+e.skewY,a.part.data.rotat=a.part.data.rotat+e.rotat);var n=d3.transition().duration(e.dur).delay(e.del).ease(e.ease);let i="scale("+a.part.data.scalX+","+a.part.data.scalY+")  translate("+a.part.data.tranX+","+a.part.data.tranY+")  rotate("+a.part.data.rotat+") skewX("+a.part.data.skewX+") skewY("+a.part.data.skewY+")";a.element.transition(n).attr("transform",i),await sleep(e.dur+e.del),t()}))},addTransform:function(a){return new Promise((async function(t,r){null==a.dur&&(a.dur=0),null==a.del&&(a.del=0),null==a.scalX&&(a.scalX=0),null==a.scalY&&(a.scalY=0),null==a.tranX&&(a.tranX=0),null==a.tranY&&(a.tranY=0),null==a.skewX&&(a.skewX=0),null==a.skewY&&(a.skewY=0),null==a.rotat&&(a.rotat=0),null==a.ease&&(a.ease=d3.easeCubic);var n=d3.transition().duration(a.dur).delay(a.del).ease(a.ease);e.data.scalX=e.data.scalX+a.scalX,e.data.scalY=e.data.scalY+a.scalY,e.data.tranX=e.data.tranX+a.tranX,e.data.tranY=e.data.tranY+a.tranY,e.data.skewX=e.data.skewX+a.skewX,e.data.skewY=e.data.skewY+a.skewY,e.data.rotat=e.data.rotat+a.rotat,e.element.transition(n).attr("transform","scale("+e.data.scalX+","+e.data.scalY+")  translate("+e.data.tranX+","+e.data.tranY+")  rotate("+e.data.rotat+") skewX("+e.data.skewX+") skewY("+e.data.skewY+")"),await sleep(1*(a.dur+a.del)),t()}))},modTransform:function(a){return new Promise((async function(e,t){null==a.dur&&(a.dur=0),null==a.del&&(a.del=0),null==a.scalX&&(a.scalX=0),null==a.scalY&&(a.scalY=0),null==a.tranX&&(a.tranX=0),null==a.tranY&&(a.tranY=0),null==a.skewX&&(a.skewX=0),null==a.skewY&&(a.skewY=0),null==a.rotat&&(a.rotat=0),null==a.ease&&(a.ease=d3.easeCubic),null!=a.d&&(a.d=void 0===a.d?{}:a.d,a.d.dur=void 0===a.d.dur?1:a.d.dur,a.d.tranX=void 0===a.d.tranX?1:a.d.tranX,a.d.tranY=void 0===a.d.tranY?1:a.d.tranY,a.d.scalX=void 0===a.d.scalX?1:a.d.scalX,a.d.scalY=void 0===a.d.scalY?1:a.d.scalY,a.d.skewX=void 0===a.d.skewX?1:a.d.skewX,a.d.skewY=void 0===a.d.skewY?1:a.d.skewY,a.d.rotat=void 0===a.d.rotat?1:a.d.rotat,a.dur=a.dur*a.d.dur,a.tranX=a.tranX*a.d.tranX,a.tranY=a.tranY*a.d.tranY,a.scalX=a.scalX*a.d.scalX,a.scalY=a.scalY*a.d.scalY,a.skewX=a.skewX*a.d.skewX,a.skewY=a.skewY*a.d.skewY,a.rotat=a.rotat*a.d.rotat),null!=a.s&&(a.s.dur=void 0===a.s.dur?0:a.s.dur,a.s.tranX=void 0===a.s.tranX?0:a.s.tranX,a.s.tranY=void 0===a.s.tranY?0:a.s.tranY,a.s.scalX=void 0===a.s.scalX?0:a.s.scalX,a.s.scalY=void 0===a.s.scalY?0:a.s.scalY,a.s.skewX=void 0===a.s.skewX?0:a.s.skewX,a.s.skewY=void 0===a.s.skewY?0:a.s.skewY,a.s.rotat=void 0===a.s.rotat?0:a.s.rotat,a.dur=a.dur+a.s.dur,a.tranX=a.tranX+a.s.tranX,a.tranY=a.tranY+a.s.tranY,a.scalX=a.scalX+a.s.scalX,a.scalY=a.scalY+a.s.scalY,a.skewX=a.skewX+a.s.skewX,a.skewY=a.skewY+a.s.skewY,a.rotat=a.rotat+a.s.rotat),null!=a.m&&(a.m.frameSensitivity=void 0===a.m.frameSensitivity?1:a.m.frameSensitivity,a.m.timeModifier=void 0===a.m.timeModifier?1:a.m.timeModifier,a.m.rotationModifier=void 0===a.m.rotationModifier?1:a.m.rotationModifier,a.m.translationModifier=void 0===a.m.translationModifier?1:a.m.translationModifier,a.m.translationModifierX=void 0===a.m.translationModifierX?1:a.m.translationModifierX,a.m.translationModifierY=void 0===a.m.translationModifierY?1:a.m.translationModifierY,a.m.skewingModifier=void 0===a.m.skewingModifier?1:a.m.skewingModifier,a.m.skewingModifierX=void 0===a.m.skewingModifierX?1:a.m.skewingModifierX,a.m.skewingModifierY=void 0===a.m.skewingModifierY?1:a.m.skewingModifierY,a.m.scalingModifier=void 0===a.m.scalingModifier?1:a.m.scalingModifier,a.m.scalingModifierX=void 0===a.m.scalingModifierX?1:a.m.scalingModifierX,a.m.scalingModifierY=void 0===a.m.scalingModifierY?1:a.m.scalingModifierY,a.m.modifierX=void 0===a.m.modifierX?1:a.m.modifierX,a.m.modifierY=void 0===a.m.modifierY?1:a.m.modifierY,a.dur=a.dur*a.m.timeModifier,a.tranX=a.tranX*a.m.translationModifierX*a.m.translationModifier*a.m.frameSensitivity*a.m.modifierX,a.tranY=a.tranY*a.m.translationModifierY*a.m.translationModifier*a.m.frameSensitivity*a.m.modifierY,a.scalX=a.scalX*a.m.scalingModifierX*a.m.scalingModifier*a.m.frameSensitivity*a.m.modifierX,a.scalY=a.scalY*a.m.scalingModifierY*a.m.scalingModifier*a.m.frameSensitivity*a.m.modifierY,a.skewX=a.skewX*a.m.skewingModifierX*a.m.skewingModifier*a.m.frameSensitivity*a.m.modifierX,a.skewY=a.skewY*a.m.skewingModifierY*a.m.skewingModifier*a.m.frameSensitivity*a.m.modifierY,a.rotat=a.rotat*a.m.rotationModifier*a.m.frameSensitivity),null!=a.p&&(a.p.frameAdjuster=void 0===a.p.frameAdjuster?0:a.p.frameAdjuster,a.p.timeAdder=void 0===a.p.timeAdder?0:a.p.timeAdder,a.p.rotationAdder=void 0===a.p.rotationAdder?0:a.p.rotationAdder,a.p.translationAdder=void 0===a.p.translationAdder?0:a.p.translationAdder,a.p.translationAdderX=void 0===a.p.translationAdderX?0:a.p.translationAdderX,a.p.translationAdderY=void 0===a.p.translationAdderY?0:a.p.translationAdderY,a.p.skewingAdder=void 0===a.p.skewingAdder?0:a.p.skewingAdder,a.p.skewingAdderX=void 0===a.p.skewingAdderX?0:a.p.skewingAdderX,a.p.skewingAdderY=void 0===a.p.skewingAdderY?0:a.p.skewingAdderY,a.p.scalingAdder=void 0===a.p.scalingAdder?0:a.p.scalingAdder,a.p.scalingAdderX=void 0===a.p.scalingAdderX?0:a.p.scalingAdderX,a.p.scalingAdderY=void 0===a.p.scalingAdderY?0:a.p.scalingAdderY,a.p.adderX=void 0===a.p.adderX?0:a.p.adderX,a.p.adderY=void 0===a.p.adderY?0:a.p.adderY,a.dur=a.dur+a.p.timeAdder,a.tranX=a.tranX+a.p.translationAdderX+a.p.translationAdder+a.p.frameAdjuster+a.p.adderX,a.tranY=a.tranY+a.p.translationAdderY+a.p.translationAdder+a.p.frameAdjuster+a.p.adderY,a.scalX=a.scalX+a.p.scalingAdderX+a.p.scalingAdder+a.p.frameAdjuster+a.p.adderX,a.scalY=a.scalY+a.p.scalingAdderY+a.p.scalingAdder+a.p.frameAdjuster+a.p.adderY,a.skewX=a.skewX+a.p.skewingAdderX+a.p.skewingAdder+a.p.frameAdjuster+a.p.adderX,a.skewY=a.skewY+a.p.skewingAdderY+a.p.skewingAdder+a.p.frameAdjuster+a.p.adderY,a.rotat=a.rotat+a.p.rotationAdder+a.p.frameAdjuster),await i.addTransform(a),e()}))},setTransform:function(a){return new Promise((async function(t,r){null==a.dur&&(a.dur=0),null==a.del&&(a.del=0),null==a.scalX&&(a.scalX=1),null==a.scalY&&(a.scalY=1),null==a.tranX&&(a.tranX=0),null==a.tranY&&(a.tranY=0),null==a.skewX&&(a.skewX=0),null==a.skewY&&(a.skewY=0),null==a.rotat&&(a.rotat=0),null==a.ease&&(a.ease=d3.easeCubic);var n=d3.transition().duration(a.dur).delay(a.del).ease(a.ease);e.data.scalX=e.data.scalX-(e.data.scalX-a.scalX),e.data.scalY=e.data.scalY-(e.data.scalY-a.scalY),e.data.tranX=e.data.tranX-(e.data.tranX-a.tranX),e.data.tranY=e.data.tranY-(e.data.tranY-a.tranY),e.data.skewX=e.data.skewX-(e.data.skewX-a.skewX),e.data.skewY=e.data.skewY-(e.data.skewY-a.skewY),e.data.rotat=e.data.rotat-(e.data.rotat-a.rotat),e.element.transition(n).attr("transform","scale("+e.data.scalX+","+e.data.scalY+")  translate("+e.data.tranX+","+e.data.tranY+")  rotate("+e.data.rotat+") skewX("+e.data.skewX+") skewY("+e.data.skewY+")"),await sleep(1*(a.dur+a.del)),t()}))},moveTransform:function(a){return new Promise((async function(t,r){null==a.dur&&(a.dur=0),null==a.del&&(a.del=0),null==a.scalX&&(a.scalX=e.data.scalX),null==a.scalY&&(a.scalY=e.data.scalY),null==a.tranX&&(a.tranX=e.data.tranX),null==a.tranY&&(a.tranY=e.data.tranY),null==a.skewX&&(a.skewX=e.data.skewX),null==a.skewY&&(a.skewY=e.data.skewY),null==a.rotat&&(a.rotat=e.data.rotat),null==a.ease&&(a.ease=d3.easeCubic),null==a.ease&&(a.ease=d3.easeCubic);var n=d3.transition().duration(a.dur).delay(a.del).ease(a.ease),i=e.element.node().getBBox();e.data.tranX=a.tranX-i.x-e.data.tranX,e.data.tranY=a.tranY-i.y-e.data.tranY,e.element.transition(n).attr("transform","scale("+e.data.scalX+","+e.data.scalY+")  translate("+e.data.tranX+","+e.data.tranY+")  rotate("+e.data.rotat+") skewX("+e.data.skewX+") skewY("+e.data.skewY+")"),await sleep(1*(a.dur+a.del)),t()}))},resetOrigin:function(a,t){e.data.origX=a,e.data.origY=t,e.element.attr("transform-origin",a+"px "+t+"px")},resetFullBodyOrigin:function(a,t){function r(a,e,t){originx3=parseInt(a.data.origX)+parseInt(e),originy3=parseInt(a.data.origY)+parseInt(t),a.anim.prim.resetOrigin(originx3,originy3)}e.anim.prim.resetMovetoOrigin(a,t),r(e.UpperBody,a,t),r(e.UpperBody.Head,a,t),r(e.UpperBody.Head.Hair,a,t),r(e.UpperBody.Head.Face,a,t),r(e.UpperBody.LeftY.Arm,a,t),r(e.UpperBody.LeftY.Fore,a,t),r(e.UpperBody.LeftY.Hand,a,t),r(e.UpperBody.Right.Arm,a,t),r(e.UpperBody.Right.Fore,a,t),r(e.UpperBody.Right.Hand,a,t),r(e.LowerBody,a,t),r(e.LowerBody.LeftY.Leg,a,t),r(e.LowerBody.LeftY.Calf,a,t),r(e.LowerBody.LeftY.Foot,a,t),r(e.LowerBody.Right.Leg,a,t),r(e.LowerBody.Right.Calf,a,t),r(e.LowerBody.Right.Foot,a,t)},resetMovetoOrigin:function(a,t,r){var n=e.element.node().getBBox(),i=a-n.x-n.width/2,d=t-n.y-n.height/2;e.element.attr("transform-origin",a+"px "+t+"px"),e.data.tranX=e.data.tranX+i,e.data.tranY=e.data.tranY+d,e.element.attr("transform","scale("+e.data.scalX+","+e.data.scalY+")  translate("+e.data.tranX+","+e.data.tranY+")  rotate("+e.data.rotat+") ")},resetAndMove:function(t,r,n,i,d=0,s=0){return new Promise((async function(o,l){const c=e.element,m=c.node().getBBox(),p=m.x+m.width/2,u=m.y+m.height/2,g=t-p,f=r-u;c.style("transform-origin",`${t}px ${r}px`);const w=n-t+g,_=i-r+f;c.transition().duration(0).attr("transform",`translate(${g}, ${f})`);const y=d3.transition().duration(d).delay(s).ease(d3.easeCubic);c.transition(y).attr("transform",`translate(${w}, ${_})`),e.data.tranX=w,e.data.tranY=_,a.data.origX=t,a.data.origY=r,await sleep(d+s),o()}))},resetAndTransform:function(a,t,r,n,i){return new Promise((async function(d,s){null==i.dur&&(i.dur=1e3),null==i.del&&(i.del=0),null==i.scalX&&(i.scalX=e.data.scalX),null==i.scalY&&(i.scalY=e.data.scalY),null==i.skewX&&(i.skewX=e.data.skewX),null==i.skewY&&(i.skewY=e.data.skewY),null==i.rotat&&(i.rotat=e.data.rotat),null==i.ease&&(i.ease=d3.easeCubic);const o=e.element,l=o.node().getBBox(),c=l.x+l.width/2,m=l.y+l.height/2,p=a-c,u=t-m;o.style("transform-origin",`${a}px ${t}px`);const g=r-a+p,f=n-t+u;o.transition().duration(0).attr("transform",`translate(${p}, ${u})`);const w=d3.transition().duration(0).delay(0).ease(d3.easeCubic);o.transition(w).attr("transform",`translate(${g}, ${u}) scale(${i.scalX}, ${i.scalY}) skewX(${i.skewX}) skewY(${i.skewY}) rotate(${i.rotat})`),e.data.tranX=g,e.data.tranY=f,e.data.scalX=i.scalX,e.data.scalY=i.scalY,e.data.skewX=i.skewX,e.data.skewY=i.skewY,e.data.rotat=i.rotat,await sleep(i.dur+i.del),d()}))},switchPathData:function(a){return new Promise((async function(t,r){null==a.newColor&&(a.newColor=a.num),null==a.newLine&&(a.newLine=a.num),null==a.ease&&(a.ease=d3.easeSinOut);let n=e.lineGroup[a.newLine-1];null==n&&(n={w:1}),d3.select("#PathPoly_"+a.num+e.data.id).transition().duration(a.dur).delay(a.del).ease(a.ease).attr("d",a.data),d3.select("#PathPoly_"+a.num+e.data.id).style("fill","url(#ColorGradient_"+a.num+e.data.id+")"),d3.select("#PathLine_"+a.num+e.data.id).transition().duration(a.dur).delay(a.del).ease(a.ease).attr("d",a.data),d3.select("#PathLine_"+a.num+e.data.id).style("stroke","url(#LineGradient_"+a.num+e.data.id+")"),await sleep(a.dur+a.del),t()}))},updateGradients:function(a,t,r,n){let i="Color";i=r?"Color":"Line";const d=`${i}Gradient_${t}${e.data.id}`,s=d3.select(`#${d}`);if(s.selectAll("stop").remove(),a?a.color.forEach((a=>{s.append("stop").attr("offset",`${a.offset}%`).attr("stop-color",a.color).attr("stop-opacity",a.opacity)})):s.append("stop").attr("offset","100%").attr("stop-color","RED").attr("stop-opacity","0"),null!=n){const a=`PathLine_${t}${e.data.id}`;d3.select(`#${a}`).style("stroke-width",n)}},switchGradientData:function(a){return new Promise((async function(t,r){null==a.id1&&(a.id1="#ColorGradient_"+a.num+e.data.id),null==a.id2&&(a.id2="#ColorGradient_"+a.newColor+e.data.id),null==a.newColor&&(a.newColor=a.num);var n=d3.select(a.id1),i=d3.select(a.id2),d=n.selectAll("stop"),s=i.selectAll("stop"),o=d.size(),l=s.size(),c=d.nodes().map((function(a){return{color:d3.select(a).style("stop-color"),offset:d3.select(a).attr("offset")}}));d3.easeCubic;o>l&&d.filter((function(a,e){return e>=l})).remove(),(d=n.selectAll("stop")).each((function(e,t){var r=d3.select(this),n=d3.select(s.nodes()[t]).style("stop-color");r.transition().duration(a.dur).delay(a.del).ease(a.ease).style("stop-color",n)})),console.log(c)}))},switchElementData:function(i,d){return new Promise((async function(s,o){1==n.length&&(n[1]=""),console.log(d),console.log(e,d.newElement.ver),console.log(e.colorMap,d.newElement.ver);let l=i[e.colorMap][d.newElement.ver];console.log(l),null!=d.newColor&&(l=await d3.json(d.newColor)),d3.select("#"+e.data.id).selectAll("*").remove();let c={bodyLineColorWi:1,[n[0]+n[1]]:l};c[n[0]+n[1]].colorName=l.name,c[n[0]+n[1]].colorMap=e.colorMap,element_group(a.element,"dummyArea_"+a.name,0,0,1,1,0,0,0),adjustPathCoordinates(d.newElement.part,d.x,d.y),part_Standard_data(a,r,n[0],n[1],c,d.newElement,t),s()}))},switchElement:function(){return new Promise((async function(t,n){e.element=d3.select("#"+e.data.id),sub_body_Processing(a,r.element,e,!1,!1,!1),t()}))}};return i}function anim_MouthSpeak_fun(a){function e(e,t,r,n){return new Promise((async function(n,i){"A"==(e=e.toUpperCase())?(await a.UpperBody.Head.Face.Mouth.anim.prim.switchPathData({num:1,dur:r,del:0,data:t.part.A}),n()):"E"==e?(await a.UpperBody.Head.Face.Mouth.anim.prim.switchPathData({num:1,dur:r,del:0,data:t.part.E}),n()):"W"==e||"R"==e?(await a.UpperBody.Head.Face.Mouth.anim.prim.switchPathData({num:1,dur:r,del:0,data:t.part.WR}),n()):"T"==e||"S"==e?(await a.UpperBody.Head.Face.Mouth.anim.prim.switchPathData({num:1,dur:r,del:0,data:t.part.TS}),n()):"L"==e||"N"==e?(await a.UpperBody.Head.Face.Mouth.anim.prim.switchPathData({num:1,dur:r,del:0,data:t.part.LN}),n()):"Q"==e||"U"==e?(await a.UpperBody.Head.Face.Mouth.anim.prim.switchPathData({num:1,dur:r,del:0,data:t.part.QU}),n()):"M"==e||"B"==e||"P"==e?(await a.UpperBody.Head.Face.Mouth.anim.prim.switchPathData({num:1,dur:r,del:0,data:t.part.MBP}),n()):"F"==e||"V"==e?(await a.UpperBody.Head.Face.Mouth.anim.prim.switchPathData({num:1,dur:r,del:0,data:t.part.FV}),n()):"O"==e?(await a.UpperBody.Head.Face.Mouth.anim.prim.switchPathData({num:1,dur:r,del:0,data:t.part.O}),n()):","==e?(await sleep(1.55*r),n()):"\r\n"==e||"\n"==e?(await sleep(1.75*r),n()):" "==e?(await sleep(.5*r),n()):(await sleep(.05*r),n())}))}a.anim.prim.mouthSpeak=function(t,r,n,i){return new Promise((async function(d,s){console.log("Start",i);for(var o=0;o<i.length;o++)await e(i.charAt(o),t,r,n);await a.UpperBody.Head.Face.Mouth.anim.prim.switchPathData({num:1,dur:1.75*r,del:1.75*n,data:a.UpperBody.Head.Face.Mouth.draw.Pathfull[0].d}),d()}))};const t={A:"A",E:"E",W:"WR",R:"WR",T:"TS",S:"TS",L:"LN",N:"LN",Q:"QU",U:"QU",M:"MBP",B:"MBP",P:"MBP",F:"FV",V:"FV",O:"O"};async function r(e,r,n){const i=r.part[t[e]];i?await a.UpperBody.Head.Face.Mouth.anim.prim.switchPathData({num:1,dur:n,del:0,data:i}):console.error(`No path data found for phoneme: ${e}`)}a.anim.prim.mouthSpeak2=function(e,n,i){return new Promise((async function(d,s){const o=i.toUpperCase().split("");let l=null;const c=o.map(((a,e)=>({char:a,index:e}))).filter((a=>{const e=t[a.char];return e&&e!==l?(l=e,!0):(" "===a.char||","===a.char)&&(l=null,!0)}));console.log(i);const m=n/c.length;for(let a=0;a<c.length;a++){const n=c[a],d=c[a+1]||null;let s;if(" "===n.char)s=m;else if(","===n.char)s=m;else{s=m*(d?d.index-n.index:i.length-n.index)}t[n.char]?await r(n.char,e,s):await sleep(s)}await a.UpperBody.Head.Face.Mouth.anim.prim.switchPathData({num:1,dur:m,del:0,data:a.UpperBody.Head.Face.Mouth.draw.Pathfull[0].d}),d()}))}}function getBodyIndexMap(){return{NakedBody:0,Other:30,HairFront:1,HairBack:2,HairTip:3,HairHind:4,HairPony:5,HairSpEarsLeftY:22,HairSpEarsRight:23,HairAccessory:26,HairExtra:27,FaceEyes:8,FaceEyeLeftY:31,FaceEyeRight:32,FaceEyebrowsLeftY:33,FaceEyebrowsRight:34,FaceEyebrows:7,FacePupils:-999,FaceGlasses:9,FaceMouth:10,FaceAccessory:6,FaceEmote:11,FaceNose:24,FaceNeck:25,FaceEars:28,ClothesBelt:12,ClothesGloves:13,ClothesPants:14,ClothesShirt:15,ClothesShoes:16,ClothesSleeves:17,BackWingLeftY:18,BackWingRight:19,BackCapes:20,BackTails:21}}async function make(a){return new Promise((async function(e,t){testing=!1,anim_MouthSpeak_fun(a),anim_lib_Basic(a);var r=d3.select("#Full_SVG_Test_Space");element_group(r,"dummyArea_"+a.name,0,0,1,1,0,0,0);(a=BodyBuilder(r,a,testing)).anim.prim=anim_Standard_data(a,a,a.name),e(a)}))}async function processChar(a,e){let t={...a};delete t.assets,BodyIndexMap=getBodyIndexMap();for(const r of a.assets)for(const[a,n]of Object.entries(r))try{if("string"==typeof n.colorfile){const e=await d3.json(n.colorfile);e.ver===n.ver?t[a]=e:console.error(`Version mismatch for ${a}`)}else t[a]=e[BodyIndexMap[a]][n.ver];null!=n.x&&(t[a].x=n.x),null!=n.y&&(t[a].y=n.y),t[a].colorMap=BodyIndexMap[a]}catch(a){}return t}function Rotation_points(a,e,t,r,n,i,d,s,o,l){o&&(l=t.d.split(/(?=[LMC])/)[0].trim().split(" "),o=!1);var c=element_path(element_group(d3.select("#dummyArea_"+e),"Temp_"+a.partID,0,0,1,1,0,0,0),"TempPath_"+a.partID,t.d,1,1,0,0,0,"black","black",1,1).node().getBBox();d3.select("#Temp_"+a.partID).remove();for(var m=!1,p="",u=1;u<t.d.length;u++)1===t.d.charAt(u).length&&t.d.charAt(u).match(/[a-z]/i)&&(m=!0),m||(p+=t.d.charAt(u));return c.x>n&&(n=c.x),c.y>i&&(i=c.y),c.width>d&&(d=c.width),c.height>s&&(s=c.height),r.push(p.split(" ")),n=Number(n)+Number(l[1]),i=Number(i)+Number(l[2]),0==c.x&&(console.log(t),console.log(a),console.log(c),console.log(p)),s}function sleep(a){return new Promise((e=>setTimeout(e,a)))}

function anim_lib_Basic(person){let e={test:async function(e){return new Promise((async function(e,t){ var i = {}

// DO NOT EDIT ABOVE
// -------------------------------------------------------------------------------------------------------

// ADD CODE HERE



// -------------------------------------------------------------------------------------------------
// DO NOT EDIT BELOW
}))}};person.anim.lib={},person.anim.lib.basic=e}async function mainFunction(){let a=d3.select("#Full_SVG_Test_Space");element_img(a,"ImgScreen",2e3,1e3,"../Backgrounds/school-cafeteria-bg1.png","Black",0,1,1,0,0,0),element_group(a,"ruler",0,0,1,1,0,0,0);element_group(a,"Event1",0,0,1,1,0,0,0);updateImageProperties("ImgScreen",100,2,-550,-300,"0.1s");var e=await make(await d3.json("test1.json")),t=await make(await d3.json("test2.json")),r=await make(await d3.json("test3.json")),n=await make(await d3.json("test4.json")),i=await make(await d3.json("test5.json"));await async function(){e.anim.prim.resetAndMove(200,400,200,400),e.anim.lib.basic.test({}),t.anim.prim.resetAndMove(500,400,500,400),t.anim.lib.basic.test({}),r.anim.prim.resetAndMove(800,400,800,400),r.anim.lib.basic.test({}),n.anim.prim.resetAndMove(1100,400,1100,400),n.anim.lib.basic.test({}),i.anim.prim.resetAndMove(1400,400,1400,400),i.anim.lib.basic.test({})}()}mainFunction();